<div class="page-container">
  
  <div class="page-header">
    <div>
      <h1 class="page-title">
        <span class="material-icons">people</span>
        Gestión de Usuarios
      </h1>
      <p class="page-subtitle">Administra los usuarios del sistema</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-primary" routerLink="/admin/usuarios/create">
        <span class="material-icons">person_add</span>
        Nuevo Usuario
      </button>
    </div>
  </div>

  
  <div class="filters-section card">
    <div class="search-bar">
      <span class="material-icons">search</span>
      <input type="text" placeholder="Buscar usuario por nombre, email o rol..." [value]="searchQuery" (input)="onSearch($event.target.value)">
    </div>
    <div class="filter-buttons">
      <button class="btn btn-sm btn-light" (click)="toggleFilters()">
        <span class="material-icons">filter_list</span>
        Filtros
      </button>
      <button class="btn btn-sm btn-light" (click)="exportCSV()">
        <span class="material-icons">download</span>
        Exportar
      </button>
    </div>
    <div class="filters-panel" *ngIf="showFilters">
      <div class="filters-grid">
        <label>
          Rol
          <select [(ngModel)]="selectedRoleId" (change)="applyFilter()">
            <option [ngValue]="'all'">Todos</option>
            <option *ngFor="let r of roles" [ngValue]="r.id">{{ r.name }}</option>
          </select>
        </label>
        <label>
          Estado
          <select [(ngModel)]="selectedStatus" (change)="applyFilter()">
            <option [ngValue]="'all'">Todos</option>
            <option [ngValue]="'active'">Activo</option>
            <option [ngValue]="'inactive'">Inactivo</option>
          </select>
        </label>
      </div>
      <div class="filters-actions">
        <button class="btn btn-sm btn-light" (click)="clearFilters()">Limpiar</button>
        <button class="btn btn-sm btn-primary" (click)="applyFilter()">Aplicar</button>
      </div>
    </div>
  </div>

  
  <div class="card">
    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr>
            <th>
              <input type="checkbox">
            </th>
            <th>Usuario</th>
            <th>Email</th>
            <th>Rol</th>
            <th>Estado</th>
            <th>Último acceso</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="loading">
            <td colspan="7" class="text-center">
              <div class="spinner">Cargando usuarios...</div>
            </td>
          </tr>
          <tr *ngIf="error && !loading">
            <td colspan="7" class="text-center text-danger">
              {{ error }}
            </td>
          </tr>
          <tr *ngFor="let usuario of (filtered.length ? filtered : usuarios)">
            <td>
              <input type="checkbox">
            </td>
            <td>
              <div class="user-info">
                <div class="user-avatar">
                  <span class="material-icons">account_circle</span>
                </div>
                <div>
                  <div class="user-name">{{ usuario.username }}</div>
                  <div class="user-id">#{{ usuario.id }}</div>
                </div>
              </div>
            </td>
            <td>
              <span class="email-text">{{ usuario.email }}</span>
            </td>
            <td>
              <span class="badge" [ngClass]="getRoleBadgeClass(usuario.profile?.name || 'Sin rol')">
                {{ usuario.profile?.name || 'Sin rol' }}
              </span>
            </td>
            <td>
              <span class="badge" [ngClass]="usuario.is_active ? 'badge-success' : 'badge-danger'">
                {{ usuario.is_active ? 'Activo' : 'Inactivo' }}
              </span>
            </td>
            <td>
              <span class="date-text">{{ usuario.updated_at ? (usuario.updated_at | date:'dd/MM/yyyy HH:mm') : 'Nunca' }}</span>
            </td>
            <td>
              <div class="action-buttons">
                <button
                  class="btn-icon"
                  [routerLink]="['/admin/usuarios', usuario.id]"
                  title="Ver detalles">
                  <span class="material-icons">visibility</span>
                </button>
                <button
                  class="btn-icon"
                  [routerLink]="['/admin/usuarios', usuario.id, 'edit']"
                  title="Editar">
                  <span class="material-icons">edit</span>
                </button>
                <button
                  class="btn-icon danger"
                  (click)="deleteUsuario(usuario)"
                  title="Eliminar">
                  <span class="material-icons">delete</span>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    
    <div class="table-footer">
      <div class="table-info">
        Mostrando <strong>{{ (filtered.length ? filtered.length : usuarios.length) }}</strong> de <strong>{{ usuarios.length }}</strong> usuarios
      </div>
      <div class="pagination">
        <button class="btn btn-sm btn-light" disabled>
          <span class="material-icons">chevron_left</span>
        </button>
        <button class="btn btn-sm btn-primary">1</button>
        <button class="btn btn-sm btn-light">2</button>
        <button class="btn btn-sm btn-light">3</button>
        <button class="btn btn-sm btn-light">
          <span class="material-icons">chevron_right</span>
        </button>
      </div>
    </div>
  </div>

  
  <div class="empty-state" *ngIf="usuarios.length === 0">
    <span class="material-icons">people_outline</span>
    <h3>No hay usuarios registrados</h3>
    <p>Comienza agregando tu primer usuario al sistema</p>
    <button class="btn btn-primary" routerLink="/admin/usuarios/create">
      <span class="material-icons">person_add</span>
      Crear Usuario
    </button>
  </div>
</div>
